# Setting Up Google Cloud Storage (GCS) Bucket for Veo Videos

This guide will help you set up a GCS bucket for storing Veo 3 generated videos.

## Prerequisites

1. A Google Cloud Project (you should already have one if Veo is working)
2. Google Cloud SDK (`gcloud`) installed, or access to Google Cloud Console
3. Service account with appropriate permissions

## Step 1: Create a GCS Bucket

### Option A: Using Google Cloud Console (Web UI)

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Navigate to **Cloud Storage** > **Buckets**
3. Click **Create Bucket**
4. Fill in the details:
   - **Name**: `your-project-id-veo3-videos` (must be globally unique)
   - **Location type**: Choose **Region** (recommended: same region as your Vertex AI resources, e.g., `us-central1`)
   - **Storage class**: **Standard**
   - **Access control**: **Uniform** (recommended)
   - Click **Create**

### Option B: Using gcloud CLI

```bash
# Set your project ID (replace with your actual project ID)
export PROJECT_ID="your-project-id"
export BUCKET_NAME="${PROJECT_ID}-veo3-videos"
export LOCATION="us-central1"  # Use same region as your Vertex AI resources

# Create the bucket
gsutil mb -p ${PROJECT_ID} -l ${LOCATION} gs://${BUCKET_NAME}

# Verify bucket was created
gsutil ls gs://${BUCKET_NAME}
```

## Step 2: Set Up Service Account Permissions

Your service account needs permission to write to the GCS bucket.

### Option A: Using Google Cloud Console

1. Go to **IAM & Admin** > **Service Accounts**
2. Find your service account (usually something like `service-account@your-project-id.iam.gserviceaccount.com`)
3. Click on it, then go to **Permissions** tab
4. Click **Grant Access**
5. Add the role: **Storage Object Admin** (or **Storage Admin** for full access)
6. Click **Save**

### Option B: Using gcloud CLI

```bash
# Set variables
export PROJECT_ID="your-project-id"
export SERVICE_ACCOUNT_EMAIL="your-service-account@your-project-id.iam.gserviceaccount.com"
export BUCKET_NAME="${PROJECT_ID}-veo3-videos"

# Grant Storage Object Admin role
gcloud projects add-iam-policy-binding ${PROJECT_ID} \
    --member="serviceAccount:${SERVICE_ACCOUNT_EMAIL}" \
    --role="roles/storage.objectAdmin"

# Or grant Storage Admin role (broader permissions)
gcloud projects add-iam-policy-binding ${PROJECT_ID} \
    --member="serviceAccount:${SERVICE_ACCOUNT_EMAIL}" \
    --role="roles/storage.admin"
```

## Step 3: Configure Environment Variables

Add the following to your `.env` file:

```env
# GCS Bucket for Veo videos
VEO3_STORAGE_URI=gs://your-project-id-veo3-videos/videos/

# Make sure these are also set (you probably already have them)
GOOGLE_CLOUD_PROJECT_ID=your-project-id
GOOGLE_APPLICATION_CREDENTIALS=path/to/your/service-account-key.json
```

**Important Notes:**
- The `VEO3_STORAGE_URI` must end with a trailing slash (`/`)
- The path `videos/` is a prefix folder within the bucket (you can change this if needed)
- Your service account key file path should be absolute or relative to your backend directory

## Step 4: Verify Setup

1. Restart your backend server
2. Look for these log messages on startup:
   ```
   [Veo3] Veo 3 service initialized (Google Cloud Vertex AI)
   [Veo3] Project ID: your-project-id
   [Veo3] Location: us-central1
   [Veo3] Using storage URI: gs://your-project-id-veo3-videos/videos/
   ```

## Step 5: Test Video Generation

Try generating a video with extensions enabled. The video should:
1. Be generated by Veo API
2. Be automatically stored in your GCS bucket at: `gs://your-project-id-veo3-videos/videos/...`
3. Return a GCS URI or download endpoint URL

## Troubleshooting

### Error: "Bucket not found"
- Verify the bucket name is correct in `VEO3_STORAGE_URI`
- Make sure the bucket exists: `gsutil ls gs://your-bucket-name`
- Check that the bucket is in the same region as your Vertex AI resources

### Error: "Permission denied" or "Access denied"
- Verify your service account has `Storage Object Admin` or `Storage Admin` role
- Check that `GOOGLE_APPLICATION_CREDENTIALS` points to the correct service account key file
- Ensure the service account key file has the correct permissions

### Error: "Invalid storage URI format"
- Make sure `VEO3_STORAGE_URI` starts with `gs://`
- Ensure it ends with a trailing slash (`/`)
- Verify the bucket name doesn't contain invalid characters

## Bucket Naming Requirements

GCS bucket names must:
- Be globally unique across all Google Cloud projects
- Be 3-63 characters long
- Contain only lowercase letters, numbers, and hyphens
- Start and end with a letter or number
- Not contain consecutive hyphens
- Not be formatted as an IP address (e.g., `192.168.1.1`)

## Cost Considerations

- **Storage**: ~$0.020 per GB/month (Standard storage class)
- **Operations**: 
  - Write operations: $0.05 per 10,000 operations
  - Read operations: $0.004 per 10,000 operations
- **Data transfer**: Free within the same region

For typical Veo video usage (videos are usually 5-20 MB each), costs are minimal.

## Next Steps

Once your GCS bucket is set up:
- Videos will be automatically stored in GCS
- You can access videos via GCS URIs: `gs://your-bucket/videos/...`
- You can download videos using `gsutil cp` or the Google Cloud Console
- Videos will be organized in the `videos/` folder (or whatever prefix you specified)






